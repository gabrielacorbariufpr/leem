const nome = localStorage.getItem('nome') || 'Usu√°rio';
const professor = localStorage.getItem('professor') || 'Professor';
const disciplina = localStorage.getItem('disciplina') || 'Disciplina';

// Dados simulados de ranking
const rankingXP = [
  { usuario: 'Alice', total_xp: 180 },
  { usuario: 'Bob', total_xp: 165 },
  { usuario: nome, total_xp: 150 }, // Usu√°rio atual
  { usuario: 'Carol', total_xp: 140 },
  { usuario: 'David', total_xp: 130 }
];

const rankingTempo = [
  { usuario: 'Carol', tempo_total: '02:10' },
  { usuario: nome, tempo_total: '02:34' }, // Usu√°rio atual
  { usuario: 'Alice', tempo_total: '02:45' },
  { usuario: 'Bob', tempo_total: '03:00' },
  { usuario: 'David', tempo_total: '03:15' }
];

// Dados do pr√≥prio usu√°rio
const xpFinal = 150;
const tempoFinal = '02:34';
const respostas = [
  'Todos participaram bem.',
  'Sim, j√° vivenciei.',
  'Contribu√≠ com ideias.',
  'Sim, dei sugest√µes.',
  'Sim, fiz algo parecido.',
  'Me senti muito envolvido.',
  'Sim, tivemos desafios t√©cnicos.',
  'Aprendi muito sobre colabora√ß√£o.',
  'Sugiro mais tempo para a atividade.',
  'Foi uma √≥tima experi√™ncia.'
];

// Preenchendo os dados b√°sicos
document.getElementById('nomeUsuario').textContent = nome;
document.getElementById('nomeProfessor').textContent = professor;
document.getElementById('nomeDisciplina').textContent = disciplina;
document.getElementById('xpFinal').textContent = xpFinal;
document.getElementById('tempoFinal').textContent = tempoFinal;

// Preencher Hist√≥rico de Respostas
const historico = document.getElementById('historicoRespostas');
respostas.forEach((resp, i) => {
  const p = document.createElement('p');
  p.textContent = `Etapa ${i + 1}: ${resp}`;
  historico.appendChild(p);
});

// Ranking XP - Top 3
const rankingXPTop = rankingXP.slice(0, 3);
document.getElementById('rankingXPTop').innerHTML = rankingXPTop.map((u, i) =>
  `<p>${i + 1}¬∫ ${u.usuario} - ‚≠ê ${u.total_xp} XP</p>`
).join('');

// Ranking Tempo - Top 3
const rankingTempoTop = rankingTempo.slice(0, 3);
document.getElementById('rankingTempoTop').innerHTML = rankingTempoTop.map((u, i) =>
  `<p>${i + 1}¬∫ ${u.usuario} - ‚è±Ô∏è ${u.tempo_total}</p>`
).join('');

// Posi√ß√£o do usu√°rio
const posXP = rankingXP.findIndex(u => u.usuario === nome) + 1;
const posTempo = rankingTempo.findIndex(u => u.usuario === nome) + 1;

document.getElementById('rankingXP').textContent = posXP ? `${posXP}¬∫ lugar` : 'N/A';
document.getElementById('rankingTempo').textContent = posTempo ? `${posTempo}¬∫ lugar` : 'N/A';

// Medalha
const medalha = posXP === 1 ? 'üèÖ Ouro'
  : posXP === 2 ? 'ü•à Prata'
  : posXP === 3 ? 'ü•â Bronze'
  : 'üéñÔ∏è Participa√ß√£o';
document.getElementById('medalha').textContent = medalha;

// Funcionalidade dos bot√µes
function compartilharComProfessor() {
  const texto = `Ol√° Professor(a) ${professor}, conclui minha miss√£o na disciplina ${disciplina}!\n‚≠ê XP: ${xpFinal}\n‚è±Ô∏è Tempo: ${tempoFinal}\nRanking XP: ${posXP}¬∫\nRanking Tempo: ${posTempo}¬∫.\nMinha medalha: ${medalha}`;
  const url = `https://wa.me/?text=${encodeURIComponent(texto)}`;
  window.open(url, '_blank');
}

function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text('Painel de Finaliza√ß√£o - LEEM', 10, 10);
  doc.text(`Nome: ${nome}`, 10, 20);
  doc.text(`Professor(a): ${professor}`, 10, 30);
  doc.text(`Disciplina: ${disciplina}`, 10, 40);
  doc.text(`XP Final: ${xpFinal}`, 10, 50);
  doc.text(`Tempo: ${tempoFinal}`, 10, 60);
  doc.text(`Ranking XP: ${posXP}¬∫ lugar`, 10, 70);
  doc.text(`Ranking Tempo: ${posTempo}¬∫ lugar`, 10, 80);
  doc.text(`Medalha: ${medalha}`, 10, 90);

  respostas.forEach((r, i) => {
    doc.text(`Etapa ${i + 1}: ${r}`, 10, 100 + i * 10);
  });

  doc.save('painel-finalizacao-leem.pdf');
}

function refazerMissao() {
  window.location.href = 'pos-avaliacao.html?refazer=true';
}
