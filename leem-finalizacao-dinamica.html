<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel de FinalizaÃ§Ã£o - LEEM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
  <h1>Painel de FinalizaÃ§Ã£o</h1>

  <div class="info">
    <p><strong>Nome:</strong> <span id="nomeUsuario"></span></p>
    <p><strong>Professor(a):</strong> <span id="nomeProfessor"></span></p>
    <p><strong>Disciplina:</strong> <span id="nomeDisciplina"></span></p>
    <p><strong>XP Final:</strong> <span id="xpFinal">0</span></p>
    <p><strong>Tempo Total:</strong> <span id="tempoFinal">00:00</span></p>
    <p><strong>Ranking XP:</strong> <span id="rankingXP">-</span></p>
    <p><strong>Ranking Tempo:</strong> <span id="rankingTempo">-</span></p>
    <p><strong>Medalha:</strong> <span id="medalha">-</span></p>
  </div>

  <h2>ğŸ† Ranking XP - Top 3</h2>
  <div id="rankingXPTop"></div>

  <h2>â±ï¸ Ranking Tempo - Top 3</h2>
  <div id="rankingTempoTop"></div>

  <h3>ğŸ“œ HistÃ³rico de Respostas</h3>
  <div id="historicoRespostas"></div>

  <div class="acoes">
    <button onclick="window.location.href='pos-avaliacao.html?refazer=true'">ğŸ”„ Refazer</button>
    <button onclick="window.location.href='index.html'">ğŸ  Voltar ao InÃ­cio</button>
    <button onclick="compartilharComProfessor()">ğŸ“¤ Compartilhar</button>
    <button onclick="gerarPDF()">ğŸ–¨ï¸ Gerar PDF</button>
  </div>
</div>

<script>
const nome = localStorage.getItem('nome') || 'UsuÃ¡rio';
const professor = localStorage.getItem('professor') || 'Professor';
const disciplina = localStorage.getItem('disciplina') || 'Disciplina';

// Dados simulados
const xpFinal = 150;
const tempoFinal = '02:34';
const respostas = [
  'Todos participaram bem.',
  'Sim, jÃ¡ vivenciei.',
  'ContribuÃ­ com ideias.',
  'Sim, dei sugestÃµes.',
  'Sim, fiz algo parecido.',
  'Me senti muito envolvido.',
  'Sim, tivemos desafios tÃ©cnicos.',
  'Aprendi muito sobre colaboraÃ§Ã£o.',
  'Sugiro mais tempo para a atividade.',
  'Foi uma Ã³tima experiÃªncia.'
];

const rankingXP = [
  { usuario: 'Alice', total_xp: 180 },
  { usuario: 'Bob', total_xp: 165 },
  { usuario: nome, total_xp: xpFinal },
  { usuario: 'Carol', total_xp: 140 },
  { usuario: 'David', total_xp: 130 }
];

const rankingTempo = [
  { usuario: 'Carol', tempo_total: '02:10' },
  { usuario: nome, tempo_total: tempoFinal },
  { usuario: 'Alice', tempo_total: '02:45' },
  { usuario: 'Bob', tempo_total: '03:00' },
  { usuario: 'David', tempo_total: '03:15' }
];

// Preencher dados
document.getElementById('nomeUsuario').textContent = nome;
document.getElementById('nomeProfessor').textContent = professor;
document.getElementById('nomeDisciplina').textContent = disciplina;
document.getElementById('xpFinal').textContent = xpFinal;
document.getElementById('tempoFinal').textContent = tempoFinal;

// HistÃ³rico de respostas
const historico = document.getElementById('historicoRespostas');
respostas.forEach((r, i) => {
  const p = document.createElement('p');
  p.textContent = `Etapa ${i + 1}: ${r}`;
  historico.appendChild(p);
});

// Ranking XP
const rankingXPTop = rankingXP.slice(0, 3);
document.getElementById('rankingXPTop').innerHTML = rankingXPTop.map((u, i) =>
  `<p>${i + 1}Âº ${u.usuario} - â­ ${u.total_xp} XP</p>`
).join('');

// Ranking Tempo
const rankingTempoTop = rankingTempo.slice(0, 3);
document.getElementById('rankingTempoTop').innerHTML = rankingTempoTop.map((u, i) =>
  `<p>${i + 1}Âº ${u.usuario} - â±ï¸ ${u.tempo_total}</p>`
).join('');

// PosiÃ§Ãµes
const posXP = rankingXP.findIndex(u => u.usuario === nome) + 1;
const posTempo = rankingTempo.findIndex(u => u.usuario === nome) + 1;

document.getElementById('rankingXP').textContent = posXP ? `${posXP}Âº lugar` : 'N/A';
document.getElementById('rankingTempo').textContent = posTempo ? `${posTempo}Âº lugar` : 'N/A';

// Medalha
const medalha = posXP === 1 ? 'ğŸ… Ouro'
  : posXP === 2 ? 'ğŸ¥ˆ Prata'
  : posXP === 3 ? 'ğŸ¥‰ Bronze'
  : 'ğŸ–ï¸ ParticipaÃ§Ã£o';
document.getElementById('medalha').textContent = medalha;

// Compartilhar com professor
function compartilharComProfessor() {
  const texto = `OlÃ¡ Professor(a) ${professor}, concluÃ­ minha missÃ£o na disciplina ${disciplina}!\nâ­ XP: ${xpFinal}\nâ±ï¸ Tempo: ${tempoFinal}\nRanking XP: ${posXP}Âº\nRanking Tempo: ${posTempo}Âº\nMedalha: ${medalha}`;
  const url = `https://wa.me/?text=${encodeURIComponent(texto)}`;
  window.open(url, '_blank');
}

// Gerar PDF
function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text('Painel de FinalizaÃ§Ã£o - LEEM', 10, 10);
  doc.text(`Nome: ${nome}`, 10, 20);
  doc.text(`Professor(a): ${professor}`, 10, 30);
  doc.text(`Disciplina: ${disciplina}`, 10, 40);
  doc.text(`XP Final: ${xpFinal}`, 10, 50);
  doc.text(`Tempo: ${tempoFinal}`, 10, 60);
  doc.text(`Ranking XP: ${posXP}Âº lugar`, 10, 70);
  doc.text(`Ranking Tempo: ${posTempo}Âº lugar`, 10, 80);
  doc.text(`Medalha: ${medalha}`, 10, 90);

  respostas.forEach((r, i) => {
    doc.text(`Etapa ${i + 1}: ${r}`, 10, 100 + i * 10);
  });

  doc.save('painel-finalizacao-leem.pdf');
}
</script>

</body>
</html>
